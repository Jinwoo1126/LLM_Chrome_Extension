<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LLM Chat Side Panel</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="highlight.css">
</head>
<body class="side-panel-mode">
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="logo">
          <img src="icons/icon32.png" alt="LLM Chat Icon" class="logo-icon">
          <span>LLM Chat</span>
        </div>
        <div class="model-selector">
          <select id="model-select">
            <!-- Options will be populated dynamically -->
          </select>
        </div>
      </div>
    </div>
    <div class="chat-container">
      <div class="chat-tabs">
        <button id="tab-chat" class="tab-button active">Chat</button>
        <button id="tab-settings" class="tab-button">설정</button>
      </div>
      <div id="chat-messages" class="chat-messages"></div>
      <div id="settings-panel" class="settings-panel hidden">
        <div class="settings-group">
          <label for="api-type-select">API 종류</label>
          <select id="api-type-select">
            <option value="ollama">Ollama</option>
            <option value="vllm">vLLM</option>
          </select>
        </div>
        <div class="settings-group">
          <label for="lang-select">언어</label>
          <select id="lang-select">
            <option value="ko">한국어</option>
            <option value="en">English</option>
          </select>
        </div>
        <button id="save-settings" class="save-settings-button">저장</button>
      </div>
      <div class="input-container">
        <textarea id="user-input" placeholder="Type your message here..." rows="1"></textarea>
        <button id="send-button">Send</button>
      </div>
    </div>
  </div>
  <script src="config.js"></script>
  <script src="marked.min.js"></script>
  <script src="highlight.min.js"></script>
  <script type="module" src="popup.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      // 탭 버튼 및 패널
      const tabChat = document.getElementById('tab-chat');
      const tabSettings = document.getElementById('tab-settings');
      const chatMessages = document.getElementById('chat-messages');
      const settingsPanel = document.getElementById('settings-panel');

      if (tabChat && tabSettings && chatMessages && settingsPanel) {
        tabChat.addEventListener('click', () => {
          tabChat.classList.add('active');
          tabSettings.classList.remove('active');
          chatMessages.style.display = '';
          settingsPanel.classList.add('hidden');
        });
        tabSettings.addEventListener('click', () => {
          tabSettings.classList.add('active');
          tabChat.classList.remove('active');
          chatMessages.style.display = 'none';
          settingsPanel.classList.remove('hidden');
        });
        // 설정 저장
        const saveBtn = document.getElementById('save-settings');
        if (saveBtn) {
          saveBtn.addEventListener('click', () => {
            const apiType = document.getElementById('api-type-select').value;
            const lang = document.getElementById('lang-select').value;
            chrome.storage.local.set({ apiType, lang }, () => {
              alert('설정이 저장되었습니다.');
            });
          });
        }
        // 설정값 불러오기
        function loadSettings() {
          chrome.storage.local.get(['apiType', 'lang'], (result) => {
            if (result.apiType) document.getElementById('api-type-select').value = result.apiType;
            if (result.lang) document.getElementById('lang-select').value = result.lang;
          });
        }
        // 설정 탭 진입 시 불러오기
        tabSettings.addEventListener('click', loadSettings);
      }
    });
  </script>
</body>
</html>